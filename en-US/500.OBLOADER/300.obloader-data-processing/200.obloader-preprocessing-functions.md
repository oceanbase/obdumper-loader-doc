Preprocessing functions
==========================

You can configure a preprocessing function for each column when you define a control file.

Considerations
-------------------------

* For a preprocessing function configured for a column, only the values of the current column can be used as formal parameters. For example, `c14 "concat(c15, '_suffix')"` is not supported, and `c15 "concat(c15, '_suffix')"` is supported.



* `LPADB()` and `RPADB()` are suitable for processing characters such as letters and numbers. It may be truncated when you use it to process emojis.



* `REPLACE()` is used differently in Oracle and MySQL modes. It has the syntax that is similar to an Oracle function but is implemented like a MySQL function.



* `NVL()` refers to the corresponding built-in function in MySQL. It distinguishes an empty character from NULL in implementation.



* For preprocessing functions related to date and time, such as `SYSTIMESTAMP`, `TMSFMT()`, and `TO_TIMESTAMP()`, the value is accurate only to milliseconds. In addition, the server clock must be the same as that of the database.



* `LPAD(char,length[,pad_string])` and `RPAD(char,length[,pad_string])` refer to the corresponding built-in functions of MySQL. The length parameter indicates the total length of the return value that is displayed on the client. In most cases, it displays the actual number of characters in the return value. However, for some multibyte character sets, the displayed length of a string may differ from the actual length. Therefore, we recommend that you do not use this function to process multibyte values.

Functions
-------------------------

The following table describes the preprocessing functions supported in the current version.


| **Function signature** | **Return type** | **Description** |
|-------------------------------------------------------------------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| LOWER(char) | String | Converts letters in a parameter value into lowercase letters.  The parameter value can be a column name, constant, or function expression. If the parameter value is a constant, quote it with single quotation marks (' '). <br>Example: `LOWER('A')`.  |
| LTRIM(char[,set]) | String | Matches and truncates a parameter value from left to right.  The value of the `char` parameter can be a column name, a constant, or a function expression. The value of the `set` parameter is a constant. By default, if the `set` parameter is omitted, its value is replaced with a space. <br>Example: `LTRIM(' abc ')`.  |
| RTRIM(char[,set]) | String | Matches and truncates a parameter value from right to left.  The value of the `char` parameter can be a column name, constant, or function expression. The value of the `set` parameter is a constant. By default, if the `set` parameter is omitted, its value is replaced with a space. <br>Example: `RTRIM(' abc ')`.  |
| SUBSTR(char,position[,length]) | String | Truncates a parameter value based on the specified start position and length.  The value of the `char` parameter can be a column name, constant, or function expression. The values of the `position` and `length` parameters are numeric constants. <br>Example: `SUBSTR('abc',0,3)`.  |
| TRIM(char) | String | Truncates leading and trailing spaces of a parameter value. The value of the `char` parameter can be a column name, a constant, or a function expression. <br>Example: `TRIM(' abc ')`.  |
| REVERSE(char) | String | Reverses parameter values. <br>For example, `REVERSE("C1")` reverses characters in each value of the C1 column.  |
| UPPER(char) | String | Converts letters in a parameter value into uppercase letters.  The value of the `char` parameter can be a column name, constant, or function expression. If the parameter value is a constant, quote it with single quotation marks (' '). <br>Example: `UPPER('a')`.  |
| NANVL(char, default) | String | Verifies whether a parameter value is a number. If not, the default value is returned.  The value of the `char` parameter can be a column name, a constant, or a function expression. The value of the `default` parameter is a constant. <br>Example: `NANVL('1','1')`.  |
| REPLACE(char,search[,replacement]) | String | Replaces a parameter value based on the specified search condition.  The value of the `char` parameter can be a column name, constant, or function expression. The values of the `search` and `replacement` parameters are constants. <br>Example: `REPLACE('abc','a','A')`.  |
| NVL(char, default) | String | Verifies whether a parameter value is left empty. If yes, the default value is returned.  The value of the `char` parameter can be a column name, a constant, or a function expression. The value of the `default` parameter is a constant. <br>Example: `NVL('a','--')`.  |
| TO_TIMESTAMP(char,fmt1[,fmt2]) | String | Converts a parameter value into a date. If the conversion fails, `NULL` is returned.  The value of the `char` parameter can be a column name, constant, or function expression. The value of the `fmt1` parameter is a date parsing template. The value of the optional `fmt2` parameter is a date formatting template. <br>Default format of the return value of `fmt2`: yyyy-MM-dd HH:mm:ss.SSS.  |
| LENGTH(char) | String | Calculates the length of a parameter value.  The value of the `char` parameter can be a column name, a constant, or a function expression.  |
| LPAD(char,length[,pad_string]) | String | Appends a character string of the specified length to the left of a parameter value. If the specified length is smaller than the length of the parameter value, the parameter value is truncated.  The value of the `char` parameter can be a column name, a constant, or a function expression. The values of the `length` and `pad_string` parameters are constants. In addition, the value of the `pad_string` parameter must be a single-byte character. <br>Example: `LPAD('a',1,'x')`.  |
| RPAD(char,length[,pad_string]) | String | Appends a character string of the specified length to the right of a parameter value. If the specified length is smaller than the length of the parameter value, the parameter value is truncated.  The value of the `char` parameter can be a column name, a constant, or a function expression. The values of the `length` and `pad_string` parameters are constants. In addition, the value of the `pad_string` parameter must be a single-byte character. <br>Example: `RPAD('a',1,'x')`.  |
| CONVERT(char,charset1[,charset2]) | String | Converts the character set of a parameter value.  The value of the `char` parameter can be a column name, constant, or function expression. The values of the `charset1` and `charset2` parameters are constants. <br>Example: `CONVERT('a','utf-8','gbk')`.  |
| CONCAT(char1,char2) | String | Concatenates parameter values.  The values of the `char1` and `char2` parameters can be a column name, constant, or function expression. <br>Example: `CONCAT('a','b')`.  |
| NONE | String | Returns a parameter value without processing it.  |
| SYSTIMESTAMP | String | Returns the timestamp of the current server without processing the parameter value. <br>Default format: yyyy-MM-dd HH:mm:ss.SSS.  |
| SYSDATE | String | Returns the date on the current server without processing the parameter value. <br>Default format: yyyy-MM-dd HH:mm:ss.  |
| CONSTANT(char) | String | Returns a defined constant value without processing it. The value of the `char` parameter is a constant. <br>Example: `CONSTANT('1')`.  |
| TMSFMT(char,fmt1,default,fmt2) | String | Validates the date format of a parameter. If the validation fails, the default date format is returned. <br>Example: `TMSFMT(c1,'yyyyMMddHHmmssSSS','2021-03-10 00:00:00.000','yyyy-MM-dd HH:mm:ss.SSS')`.  |
| LPADB(char,byte_size[,pad_char]) | String | Appends a byte string of the specified length to the left of a parameter value. If the specified length is smaller than the length of the parameter value, the parameter value is truncated.  The value of the `char` parameter can be a column name, a constant, or a function expression. The values of the `byte_size` and `pad_char` parameters are constants. <br>Example: `LPADB('a',1,'x')`.  |
| RPADB(char,byte_size[,pad_char]) | String | Appends a byte string of the specified length to the right of a parameter value. If the specified length is smaller than the length of the parameter value, the parameter value is truncated.  The value of the `char` parameter can be a column name, a constant, or a function expression. The values of the `byte_size` and `pad_char` parameters are constants. <br>Example: `RPADB('a',1,'x')`.  |
| MASK(string str[, string upper[, string lower[, string number]]]) | String | Masks uppercase letters, lowercase letters, or numbers in a field value. <br>For example, `MASK("C1",A,a,b)` masks the values of Column C1 by replacing uppercase letters with A, lowercase letters with a, and numbers with b.  |
| MASK_FIRST_N(string str[, int n]) | String | Masks the first n characters in a field value. <br>For example, `MASK_FIRST_N("C1",'A','a','b',5)` masks the first five characters in the values of Column C1 by replacing uppercase letters with A, lowercase letters with a, and numbers with b.  |
| MASK_LAST_N(string str[, int n]) | String | Masks the last n characters in a field value. <br>For example, `MASK_LAST_N("C1",'A','a','b',5)` masks the last five characters in the values of Column C1 by replacing uppercase letters with A, lowercase letters with a, and numbers with b.  |
| MASK_SHOW_FIRST_N(string str[, int n]) | String | Masks all characters except the first n characters in a field value. <br>For example, `MASK_SHOW_FIRST_N("C1",'A','a','b',5)` masks all characters except the first five characters in the values of Column C1 by replacing uppercase letters with A, lowercase letters with a, and numbers with b.  |
| MASK_SHOW_LAST_N(string str[, int n]) | String | Masks all characters except the last n characters in a field value. <br>For example, `MASK_SHOW_LAST_N("C1",'A','a','b',5)` masks all characters except the last five characters in the values of Column C1 by replacing uppercase letters with A, lowercase letters with a, and numbers with b.  |
| SEQUENCE(int m,int n) | String | Generates an incremental sequence for a specified column. The parameter m specifies the start value and n specifies the increment step. <br>For example, `SEQUENCE(100,1)` generates a sequence with a start value of 100 and an increment step of 1.  |
| DB_SEQUENCE(string sequence) | String | Assigns sequence values to rows to be imported so that the rows can be imported into the database based on the sequence values. <br>For example, `DB_SEQUENCE(seq01)` specifies the sequence value `seq01`. <blockquote>**Note**</br>This function is supported in OBLOADER V4.1.0 and later. </blockquote> |
| CHR(string) | String | Converts a number represented by a string into an ASCII value. <ul><li>If the value of `string` is greater than 256, the function is equivalent to `'string' mod 256`. <br>For example, the results of both `CHR ('10')` and `CHR('266')` are `'\n'`. </li><li>If the value of any parameter is `NULL`, the `CHR()` function returns `NULL`. </li><li>The parameter value can be a column name or a constant. If the parameter value is a constant, quote it with single quotation marks (' '). <br>Examples: `CHR('13')` and `CHR(c1)`. </li></ul> |
| NCHR(string) | String | Converts a number represented by a string into an NVARCHAR2 value. <ul><li>Unlike the `CHR()` function, the `NCHR()` function can handle parameter values greater than 256. <br>For example, <code>NCHR('257') </code>returns <code>ā</code>. </li><li>If the value of any parameter is `NULL`, the `NCHR()` function returns `NULL`. </li><li>The parameter value can be a column name or a constant. If the parameter value is a constant, <strong></strong>quote it with single quotation marks (' ').<strong></strong> <br>Examples: <code>NCHR('13')</code> and <code>NCHR(c1)</code>. </li></ul> |
| ASCII(char) | String | Converts a character into a decimal ASCII value. <ul><li>If multiple characters are passed in, only the first character is converted. <br>For example, both `ASCII('A')` and `ASCII('abc')` return `'65'`. </li><li>The parameter value can be a column name or a constant. If the parameter value is a constant, quote it with single quotation marks (' ').<strong></strong><strong></strong> <br>For example, `ASCII('A')` or `ASCII(c1)`. </li></ul> |
| RAWTOHEX(string) | String | Converts a raw string into a hexadecimal string. <br>The parameter value can be a column name or a constant. If the parameter value is a constant, <strong></strong>quote it with single quotation marks (' ').<strong></strong> <br>Examples: `RAWTOHEX('ABC')` and `RAWTOHEX(c1)`.  |
| HEXTORAW(string) | String | Restores a hexadecimal string to a raw string. <br>The parameter value can be a column name or a constant. If the parameter value is a constant, <strong></strong>quote it with single quotation marks (' ').<strong></strong> <br>Examples: `HEXTORAW('414243')` and `HEXTORAW(c1)`. <main id="notice" type='explain'><h4>Note</h4><p>OBDUMPER can process hexadecimal data that does not contain <code>0x</code> or that is prefixed with <code>0x</code>. If you want to use OBDUMPER to process hexadecimal data, you must use the nested <code>replace </code>function to remove the data that contains <code>0x</code> but is not prefixed with `0x`. For example, you can add <code>lang=java (c1 "hextoraw(replace(c1, '0x', ''))");</code> to your code.</p></main> |
| REPLACE(char,search[,replacement]) | String | Replaces a parameter value based on the specified search condition. <br>The value of the `char` parameter can be a column name, a constant, or a function expression. The value of the `search` parameter can be a constant or a function expression. The value of the `replacement` parameter must be a constant. <br>Examples: `REPLACE('abc','a','A')` and `REPLACE('abc',CHR('13'),'!')`. |
| TRUNC(number[, decimal]) | String | Truncates a number. <ul><li>`number` indicates the number to be truncated, and `decimal` indicates the number of decimal places to be retained after truncation. For example, `TRUNC(22.29, 1)` returns `22.2`. </li><li>If `decimal` is not specified, the value of `number` is truncated without decimal places. <br>For example, `TRUNC(22.29)` returns `22`. </li><li>The value of `decimal` can be negative, which specifies to truncate `number` to the left of the decimal point and set the digit on the left of the decimal point to zero. <br>For example, `TRUNC(22.29, -1)` returns `20`. </li></ul><main id="notice" type='explain'><h4>Note</h4><p>The parameters of the function support any numeric data types and non-numeric data types that can be implicitly converted into numeric data types. </p></main> |


<main id="notice" type='notice'>
    <h4>Notice</h4>
    <p>The groovy dynamic function is no longer supported in OBLOADER V3.x. </p>
  </main>
