# 文件格式
本篇旨在介绍 OBLOADER 支持的文件格式以及使用注意事项。
## CSV、SQL、DDL、CUT、POS 与 MIX 文件格式的区别
- CSV 格式（推荐）：文件中存放按照 RFC4180 规范组织的数据。
- DDL 格式：文件中存放数据库对象的定义语句（即 DDL 语句）。
- SQL 格式：文件中存放 INSERT 语句，每条记录占一行，请勿换行。
- CUT 格式：文件中存放按照字符串分隔的数据，每条记录占一行，请勿换行。
- POS 格式：文件中存放按照固定长度的字节偏移位置组织的数据，请勿换行。
- MIX 格式（不推荐）：文件中存放任意的 DDL 和 DML 语句混合在一起的文件。
## 数据文件的格式与文件后缀名的对应关系
- 数据文件命名格式统一为：table.group.sequence.suffix。
- OBLOADER 支持 CSV、SQL、DDL、CUT、POS 和 MIX 共 6 种格式。
  - 默认 CSV 格式的文件后缀为 .csv；
  - SQL 格式的文件后缀为 .sql；
  - DDL 格式的文件后缀为 -schema.sql。除 DDL 格式外其他数据格式的数据文件后缀名可以任意。
  例如，test 表导出的 CSV 格式的文件名可以为 test.dat，但文件的内容要求为标准的 CSV 格式。导入时在命令中指定文件后缀 --file-suffix '.dat' 否则会提示数据文件未找到。
## 使用 OBLOADER 导入源自第三方工具（如 Mydumper 和 SqlDeveloper 等）导出的数据文件时的注意事项
- 导入 CSV 文件时，用户需设置正确的符号。例如行分隔符、列分隔符、定界符和转义符等。
- 导入 SQL 文件时，要求 SQL 文件中只有 INSERT 语句，并且每一条记录占一行，避免出现跨行。
- 导入 DDL 文件时，一个文件对应一个对象的定义，避免出现其它无关的内容，如注释和开关语句等。
- 最后，导入数据前须设置正确的日期时间格式。避免在导入过程中，因日期格式不正确造成导入失败。
## 指定 `--table` 选项时的注意事项
参数 `--table` 用于指定的表名。
指定多个表时使用逗号分隔，且要求表名与文件名大小写保持一致。
例如：
MySQL 模式下，如默认表名为小写，此时要求 `--table` 选项的值为小写表名，参数 `-f` 指定的目录下的文件名同样应为小写。
## 导入表结构或数据时的注意事项
- 导入表结构时，指定 `--threads` 并发数不超过 2（并发 DDL 并不一定会加快速度，在 OceanBase 中， DDL 为串行执行，每个 DDL 平均耗时 1 秒）。
- 导入大量的数据时，可能需占用较多的 OBLOADER 内存。
  - 首先可编辑 bin/obloader 脚本，修改 JVM 参数 --Xms4G 和 --Xmx4G ，分别表示 JVM 初始堆内存和最大堆内存，建议两者都设置为可用物理内存的 60%。
    ```JavaScript
    vim bin/obloader
    50 JAVA_OPTS="$JAVA_OPTS -server -Xms4G -Xmx4G -XX:MetaspaceSize=512M -XX:MaxMetaspaceSize=512M -Xss352K"
    ```
  - 其次，可在命令行中指定 --threads 选项用于控制并发，默认是 2 倍的逻辑 CPU 数量。
  - 最后，导入的性能还会受到表上的索引数量的影响。建议在建表时，除了主键和唯一键以外，索引留到数据导入结束后再创建。
-  导入时同时可能受租户的增量内存写入速度限制。
   -  如增量内存不足时会触发合并或转储。合并比较消耗性能，尽量不要触发。可开启内存的转储，并将转储的次数设置为 100 以上（通常足够坚持 24 小时 ）。
   - 如增量内存使用率达到租户限速阈值时，导入性能也会下降。
   - 如增量内存使用率已满，很容易导致数据导入失败。建议租户限速的阈值请问高于 90 。转储相关参数的设置跟租户内存的大小、写入速度都有关系，需根据实际情况进行调优。
## 公有云与私有云的区别 
- 公私有云的 proxyro 权限区别：
   - 公有云模式（限制模式）有 proxyro 权限限制，只能导出表数据，以及表和视图的结构；
   - 私有云模式（非限制模式）无 proxyro 权限限制，可导出数据库中所有数据库对象的结构和数据。
- 公私有云的连接方式区别：
   - 公有云模式：通过 --public-cloud 选项连接。
   - 私有云模式：通过 --sys-password 选项, 或提供密钥文件连接。
     > **说明**
     > 限制模式（公有云连接模式）会限制部分导入的功能、性能以及稳定性。同时，OceanBase 数据库 V2.2.30 及以上版本才支持服务端限流的能力，因此在使用限制模式时通过以下命令调整服务端限流：
     > ```SQL
     > alter system set freeze_trigger_percentage=50;
     > alter system set minor_merge_concurrence=64;
     > alter system set writing_throttling_trigger_percentage=80 t
     > ```